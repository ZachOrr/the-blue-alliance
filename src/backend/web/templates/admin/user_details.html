{% extends "admin/base.html" %}

{% block title %}{{ user.display_name }}{% endblock %}

{% block content %}

<div class="modal fade" id="admin-confirmation-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
        {% if firebase_user_is_admin %}
          Confirm Revoke Admin
        {% else %}
          Confirm Grant Admin
        {% endif %}
        </h3>
      </div>
      <div class="modal-body">
        {% if firebase_user_is_admin %}
          Are you sure you wish to revoke administrative priviliages from {{ user.display_name }} ({{ firebase_user.email }})?
        {% else %}
          Are you sure you wish to grant administrative priviliages to {{ user.display_name }} ({{ firebase_user.email }})?
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" id="confirm-button" class="btn btn-{% if firebase_user_is_admin %}danger{% else %}success{% endif %}">Confirm</button>
      </div>
    </div>
  </div>
</div>

<h1>{{ user.display_name }}{% if firebase_user_is_admin %} <span class="badge">Admin</span>{% endif %}</h1>
<form id="admin-form" action="/admin/user/{{ user.key.id() }}/admin/{% if firebase_user_is_admin %}revoke{% else %}grant{% endif %}" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <button data-toggle="modal" data-target="#admin-confirmation-modal" id="admin-button" type="submit" class="btn btn-success"><span class="glyphicon {% if firebase_user_is_admin %}glyphicon-remove{% else %}glyphicon-king{% endif %}"></span> {% if firebase_user_is_admin %}Revoke Admin{% else %}Grant Admin{% endif %}</button>
</form>
<br/>

<!-- <div class="modal fade" id="confirm-submit" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Confirm Submit
            </div>
            <div class="modal-body">
                Are you sure you want to submit the following details?
                <table class="table">
                    <tr>
                        <th>Last Name</th>
                        <td id="lname"></td>
                    </tr>
                    <tr>
                        <th>First Name</th>
                        <td id="fname"></td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a href="#" id="submit" class="btn btn-success success">Submit</a>
            </div>
        </div>
    </div>
</div> -->

<h1>TBA Account</h1>
<div>
  <a href="{{ url_for('admin.user_edit', user_id=user.key.id()) }}" class="btn btn-primary"><span class="glyphicon glyphicon-edit"></span> Edit</a>
</div>
<br/>

<table class="table table-striped table-hover">
    <tr>
        <td>Display Name</td>
        <td>{{ user.display_name }}</td>
    </tr>
    <tr>
        <td>User ID</td>
        <td>{{ user.key.id() }}</td>
    </tr>
    <tr>
        <td>Email</td>
        <td>{{ user.email }}</td>
    </tr>
    <tr>
        <td>Permissions</td>
        <td>
            <ul>
            {% for enum, permission in permissions.items() %}
                {% if enum in user.permissions %}
                    <li><strong>{{ permission.name }}</strong> – {{ permission.description }}</li>
                {% endif %}
            {% endfor %}
            </ul>
        </td>
    </tr>
    <tr>
        <td>Shadow Banned</td>
        <td>{{ user.shadow_banned }}</td>
    </tr>
    <tr>
        <td>Created</td>
        <td>{{ user.created }}</td>
    </tr>
    <tr>
        <td>Updated</td>
        <td>{{ user.updated }}</td>
    </tr>
</table>

<h2>Firebase Account</h2>
<table class="table table-striped table-hover">
    <tr>
        <td>Display Name</td>
        <td>{{ firebase_user.display_name }}</td>
    </tr>
    <tr>
        <td>User ID</td>
        <td>{{ firebase_user.uid }}</td>
    </tr>
    <tr>
        <td>Email</td>
        <td>{{ firebase_user.email }}</td>
    </tr>
    <tr>
        <td>Custom Claims</td>
        <td>
            <ul>
            {% if firebase_user.custom_claims %}
            {{ firebase_user.custom_claims }}
            </ul>
            {% endif %}
        </td>
    </tr>
    <tr>
        <td>Providers</td>
        <td>
          {{ firebase_user_providers|join(', ') }}
        </td>
    </tr>
    <tr>
        <td>Disabled</td>
        <td>{{ firebase_user.disabled }}</td>
    </tr>
    <tr>
        <td>Email Verified</td>
        <td>{{ firebase_user.email_verified }}</td>
    </tr>
    <tr>
        <td>Created</td>
        <td>{{ firebase_user.user_metadata.creation_timestamp|epoch_time_milisecond_str }}</td>
    </tr>
    <tr>
        <td>Last Token Refresh</td>
        <td>{{ firebase_user.user_metadata.last_refresh_timestamp|epoch_time_milisecond_str }}</td>
    </tr>
    <tr>
        <td>Last Sign In</td>
        <td>{{ firebase_user.user_metadata.last_sign_in_timestamp|epoch_time_milisecond_str }}</td>
    </tr>
</table>

<script>
$('#confirm-button').click(function() {
    $('#admin-form').submit();
});
</script>

{% endblock %}
